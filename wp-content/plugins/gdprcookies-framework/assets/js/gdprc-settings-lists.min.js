var gdprcSETTLISTS=(function(g){"use strict";var s={pageWrap:{},listWrapper:{},btnPostAdd:{},btnPostDel:{},btnPostSave:{},listRowsTable:{},listFieldTitle:{},listFieldMetaItem:{},};var k="gdprc-list-new-post",c="gdprc-list-rows-table",i="gdprc-list-row",q="gdprc-list-row-fields",n="gdprc-list-row-field",l="gdprc-list-row-field-post-title",d="gdprc-list-row-field-meta-item",e="gdprc-list-row-actions",u="gdprc-list-row-action",a="gdprc-btn-add",f="gdprc-btn-add-post",b="gdprc-btn-del",m="gdprc-btn-save",j="gdprc-list-selected-post",o="gdprc-list-row-selected";var p={setLastInList:function(){g(this).find("tr").removeClass("last");g(this).find("tr:last").addClass("last")},setLoadingImg:function(v){var w=g(this).siblings(".ajax-loading");if(w&&0<w.length){if(v){w.css({visibility:"visible",display:"inline-block"}).show()}else{w.css("visibility","hidden").hide()}}},getPostRow:function(x){var v=g(this),w=v.find('tr[data-post-id="'+x+'"]');if(0<w.length){return w}else{return false}},getPostId:function(){var v=g(this);if("undefined"!==typeof v.data("post-id")){return v.data("post-id")}else{return false}},deletePost:function(v){var w=g(this);w.find('tr[data-post-id="'+v+'"]').remove()}};var r=function(w){var x,v;x=/([a-zA-Z_-]+)\[\d+\]/;v=x.exec(w);if(null!=v&&null!=v[1]){return v[1]}else{return false}};var t=function(w){var x,v;x=/[a-zA-Z_-]+(?:\[[^\]]+\])\[\d+\](?:\[([a-zA-Z_-]+)\])/;v=x.exec(w);if(null!=v&&null!=v[1]){return v[1]}else{return false}};var h=function(v){if("undefined"!==typeof v.button&&2===v.button){return true}else{return false}};s.handlerBtnPostAdd=function(E){var D=E.data.thiz,y=g(this),v=y.parents(".gdprc-list-wrapper"),x=v.data("listFieldNewPost"),A=x.val();if(""!==A){y.parent(".gdprc-list-controls").hide().setLoadingImg(true);var G=false,B=false,z=false,H=false,C=null,w=null;G=(null!=v.data("has-title")&&true==v.data("has-title"))?true:G;B=(null!=v.data("has-media")&&true==v.data("has-media"))?true:B;z=(null!=v.data("can-del")&&true==v.data("can-del"))?true:z;H=(null!=v.data("can-save")&&true==v.data("can-save"))?true:H;C=(null!=v.data("post-type")&&"string"===typeof v.data("post-type"))?v.data("post-type"):"";w=(null!=v.data("context")&&"string"===typeof v.data("context"))?v.data("context"):"";var F=gdprcSETT.getAjaxArgs("gdprc-add-post",{val:A,context:w,post_type:C,has_title:G,has_media:B,can_del:z,can_save:H});g.post(ajaxurl,F,function(I){if(null==I){alert(gdprcSETT.currNsDatal10n.unknown_error);y.parent(".gdprc-list-controls").show().setLoadingImg(false);return false}switch(I.state){case"-1":alert(I.out);case"1":v.addClass("gdprc-list-has-posts");v.data("listRowsTable").append(I.out.template);v.trigger("gdprcBtnPostAdd",[D,I,v]);x.val("");y.parent(".gdprc-list-controls").show().setLoadingImg(false);break}},"json")}else{E.preventDefault();return false}};s.handlerBtnPostDel=function(B){var z=B.data.thiz,y=g(this),C=y.parents(".gdprc-list-wrapper"),A=y.parents("tr"),w,v=[];w=A.getPostId();v.push(w);if(0<v.length){if(confirm(gdprcSETT.currNsDatal10n.del_confirm_post)){y.hide().setLoadingImg(true);var x=gdprcSETT.getAjaxArgs("gdprc-del-post",{post_id:v});g.post(ajaxurl,x,function(D){if(null==D){alert(gdprcSETT.currNsDatal10n.unknown_error);y.show().setLoadingImg(true);return false}switch(D.state){case"-1":alert(D.out);case"1":if(-1!==D.out.deleted.indexOf(String(w))){g.when(C.data("listRowsTable").deletePost(w)).then(function(){C.trigger("gdprcBtnPostDel",[z,D,w])});if(0===C.data("listRowsTable").find("tr").length){C.removeClass("gdprc-list-has-posts")}}y.show().setLoadingImg(true);break}},"json")}else{B.preventDefault();return false}}};s.handlerBtnPostSave=function(F){if(h(F)){F.preventDefault();return false}var E=F.data.thiz,z=g(this),v=z.parents(".gdprc-list-wrapper"),I,L,A,B,H={},y,K,C={},D=false,J=false,x=null;I=z.parents("tr."+i);L=I.find("."+l);A=I.getPostId();B=L.val();D=(null!=v.data("group-meta")&&true==v.data("group-meta"))?true:D;if(D){J=(null!=v.data("group-meta-key"))?v.data("group-meta-key"):J}y=(""===B)?true:false;x=(null!=v.data("context")&&"string"===typeof v.data("context"))?v.data("context"):"";var w;I.find("."+d).each(function(){var M=g(this),N,O,R,P,Q;N=M.attr("name");O=M.attr("type");R=M.val();if(""===R){w=M;K=true;return false}if(!D){P=r(N);if(false!==P){H[P]=R}}else{if(false!==(Q=t(N))){H[Q]=R}}});z.trigger("gdprcBeforePostSave",[E,A,I]);C=z.data("extra-data")||{};H=g.extend(H,C);if(y||K){if(y){L.trigger("blur")}if(K){w.trigger("blur")}alert(gdprcSETT.currNsDatal10n.post_empty);return false}L.val(gdprcSETT.currNsDatal10n.updating);z.hide().setLoadingImg(true);var G=gdprcSETT.getAjaxArgs("gdprc-update-post",{context:x,post_id:A,val:B,post_meta:H,group_meta:D,group_meta_key:J});g.post(ajaxurl,G,function(N){if(null==N){alert(gdprcSETT.currNsDatal10n.unknown_error);z.show().setLoadingImg(false);return false}switch(N.state){case"-1":alert(N.out);L.val(B);z.show().setLoadingImg(false);break;case"0":if(null!=N.out.msg){alert(N.out.msg)}if(null!=N.out.fields&&g.isArray(N.out.fields)&&0<N.out.fields.length){for(var M=0;M<N.out.fields.length;M++){var O=I.find(".field-"+N.out.fields[M]);O.find("."+d).addClass("gdprc-sett-field-err")}}L.val(B);z.show().setLoadingImg(false);break;case"1":I.find(".gdprc-sett-field-err").removeClass("gdprc-sett-field-err");L.val(B);L.prop("defaultValue",B);if(N.out.meta_added){g.each(N.out.meta_added,function(Q,R){var P=I.find('input.gdprc-list-row-field-meta-item[name="'+Q+"["+A+']"]');P.attr("value",R);P.prop("defaultValue",R)})}if(N.out.changed){}v.trigger("gdprcBtnPostSave",[E,A,I,N,B]);z.show().setLoadingImg(false);break}},"json")};s.handlerRowClick=function(B){var z=B.data.thiz,A=g(this),C=A.parents(".gdprc-list-wrapper"),v=C.find("."+i),w=A.getPostId(),y,x=[];v.removeClass(o);A.addClass(o).focus();y=C.find("."+j);y.val(w)};s.events=function(){var v=this;this.listWrappers.each(function(){var w=g(this),A=(null!=w.data("click-select")&&true==w.data("click-select"))?true:false,z=(null!=w.data("context")&&"string"===typeof w.data("context"))?w.data("context"):"",B={};w.data("btnPostAdd",w.find("."+f));w.data("btnPostDel",w.find("."+b));w.data("btnPostSave",w.find("."+m));w.data("listFieldNewPost",w.find("."+k)),w.data("listRowsTable",w.find("."+c));w.data("listFieldTitle",w.find("."+l));w.data("listFieldMetaItem",w.find("."+d));if(A&&""!=z){var y=gdprcSETT.settingGrp,x=y+"["+z.replace("-","_")+"_selected]";B=w.find("."+j);B.attr({name:x});w.on("click","."+i,{thiz:v},v.handlerRowClick)}w.find('input[type="text"], .'+a).on("keypress",function(C){if(13===(C.keyCode||C.which)){C.preventDefault()}});w.on("click","."+a,{thiz:v},v.handlerBtnPostAdd);w.on("click","."+b,{thiz:v},v.handlerBtnPostDel);w.on("mousedown","."+m,{thiz:v},v.handlerBtnPostSave)});this.pageWrap.on("keypress","."+k+",."+a,{thiz:v},function(w){if(13===(w.keyCode||w.which)){g(this).closest(v.listWrappers).find("."+a).trigger("click")}});this.pageWrap.on("blur","."+l,function(x){var w=g(this);if(""===w.val()){w.val(w.prop("defaultValue"))}});this.pageWrap.on("keydown","."+d,function(x){var w=g(this);if(w.val()===w.prop("placeholder")){w.prop("value",null)}});this.pageWrap.on("blur","."+d,function(x){var w=g(this);if(""===w.val()){w.val(w.prop("defaultValue"))}if(w.val()===w.prop("placeholder")){}})};s.setCSS=function(){this.listWrappers.each(function(){var z=g(this),y=z.find("."+e),x=(null!=z.data("layout")&&"compact"===z.data("layout"))?true:false,w=(null!=z.data("outer-w")&&0<parseInt(z.data("outer-w")))?parseInt(z.data("outer-w")):false,v=(null!=z.data("can-save")&&true==z.data("can-save"))?true:false;y.each(function(){var B=g(this),I=B.parent("."+i),D=I.find("."+l),C=I.find("."+q),H=C.find("."+n),E=H.length,G=(0<E)?true:false,F=null,A=(0<B.find("span."+u).length)?true:false;if(x&&G){F=(100/E).toFixed(2);if(0<w){I.css({width:w+"%"})}}if(!v){D.prop("readonly",true)}if(G){H.css({width:F+"%"})}if(!A){C.css({"float":"none",width:"100%"});B.css({display:"none","float":"none",width:"0%"})}I.show()})})};s.init=function(){try{if(false===gdprcSETT.done){throw new Error("Could not init gdprc Setting Lists: gdprcSETT is not finished.")}this.pageWrap=g(".wrap");this.listWrappers=g(".gdprc-list-wrapper");this.btnPostAdd=g("."+f);g.fn.extend(p);this.events();this.setCSS()}catch(v){if(null!=console&&null!=console.log){console.log("gdprcookies Exception: ",v.message)}}};return s})(jQuery||{},gdprcSETTLISTS||{});jQuery(function(a){gdprcSETTLISTS.init()});